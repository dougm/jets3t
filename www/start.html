<html>
<head>
<title>jets3t - Getting Started</title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
</head>

<body bgcolor="#FFFFFF" text="#000000">
<center><h1>jets3t - Getting Started</h1></center>

<center>
	<a href="index.html">Home</a> | 
	<a href="start.html">Getting Started</a> | 
	<a href="cockpit.html">Cockpit</a> | 
	<a href="synchronize.html">Synchronize</a> | 
	<a href="api/index.html">API Documentation</a>
</center>

<p>This page will help developers get up and running with the jets3t toolkit.</p>
<p>If you only want to run the included applications, please see the <a href="cockpit.html">Cockpit</a> or <a href="synchronize.html">Synchronize</a> pages.</p>

<h2>Pre-requisites</h2>
<p>
<ul>
<li><a href="http://aws-portal.amazon.com/gp/aws/developer/subscription/index.html/103-5296594-0109452?ie=UTF8&serviceID=8&servicePlanID=6">Sign-up</a> for an Amazon Simple Storage Service account (credit card required)</li>
<li>Download the jets3t toolkit.</li>
<li>Obtain the latest <a href="http://developer.amazonwebservices.com/connect/kbcategory.jspa?categoryID=48">Technical Documentation</a> for the S3 service, in particular the API guide which will help you understand how S3 works and what you can do with it</li>
</ul>
</p>

<h2>Set-up your project</h2>
<h3>Required libraries</h3>
<p>To use jets3t you must add at least the following libraries to your classpath:
<ul>
<li>jets3t.jar (the jets3t 'toolkit' library)</li>
<li>commons-logging-1.1.jar</li>
<li>commons-codec-1.3.jar</li>
</ul>
In addition to these libraries, you must also add any libraries required by the S3 Service implementation you intend to use (see below).</p>
<h3>S3 Service Implementations</h3>
<p>jets3t includes two service implementations: REST/HTTP based on HttpClient 3; and SOAP based on Axis 1.4.</p>
<p>We <b>strongly advise</b> that you use the HttpClient-based REST/HTTP implementation as the SOAP version does not stream uploaded data and is therefore highly susceptible to OutOfMemory errors.</p>

<table>
<tr><th>Implementation</th><td>REST/HTTP</td></tr>
<tr><th>Class</th><td>org.jets3t.service.impl.rest.httpclient.RestS3Service</td></tr>
<tr><th>Required Libraries</th><td>
<ul>
<li>Commons HttpClient : commons-httpclient-3.0.1.jar</li>
<li>Commons Codec : commons-codec-1.3.jar</li>
</ul>
</td></tr>
</table>

<table>
<tr><th>Implementation</th><td>SOAP</td></tr>
<tr><th>Class</th><td>org.jets3t.service.impl.soap.axis.SoapS3Service</td></tr>
<tr><th>Issues</th><td>Uploads are buffered in memory prior to being sent, and are therefore limited to the size of the available memory</td></tr>
<tr><th>Required Libraries</th><td>
<ul>
<li>Apache Axis : axis.jar, commons-discovery-0.2.jar, jaxrpc.jar, saaj.jar, wsdl4j-1.5.1.jar</li>
<li>Castor : castor-1.0.1.jar</li>
<li>Java Activation Framework : activation.jar</li>
<li>JavaMail : mail.jar</li>
<li>Xerces : xercesImpl.jar, xmlParserAPIs.jar</li>
</ul>
</td></tr>
</table>

<p>Note: If you would prefer to use your own favourite HTTP or SOAP library, you can write your own S3Service implementation.</p>

<h3>Logging</h3>
<p>The jets3t toolkit uses Commons Logging. To configure the information logged by the toolkit, you must include a <tt>commons-logging.properties</tt> file in the classpath.</p>
<p>For example, to configure Commons Logging to use the Log4j logging library, add the Log4j library and configuration file to the classpath and use the following line in the Commons Logging config file:</p>
<tt>org.apache.commons.logging.Log=org.apache.commons.logging.impl.Log4JLogger</tt>

<h2>Basic Code Examples</h2>
<h3>S3 Object representations</h3>
<p>Items stored in S3 are represented by one of two objects:</p>
<p><h4>S3Bucket</h4></p>
<p>An <tt>S3Bucket</tt> is a top-level container in S3 in which objects are stored. Every bucket is identified by a name, and this name must be unique in S3.</p>
<p><h4>S3Object</h4></p>
<p>An <tt>S3Object</tt> is a data object stored inside a bucket. It is identified by a key, which can be any string name. An object also has a Content Length, which is the amount of the data in the object.</p>

<h3>Connnecting to S3</h3>
<p>Your Amazon Web Services (AWS) login credentials are required to manage S3 accounts. These credentials are stored in an <tt>AWSCredentials</tt> object:</p>
<pre>
AWSCredentials awsCredentials = 
	new AWSCredentials(awsAccessKey, awsSecretKey);
</pre>	
<p>To communicate with S3, create a class that implements an <tt>S3Service</tt>. We will use the REST/HTTP implementation based on HttpClient, as this is the most robust implementation provided with jets3t.</p>
<pre>
S3Service s3Service = new RestS3Service(awsCredentials);
</pre>
<p>A good test to see if your S3Service can connect to S3 is to list all the buckets you own. If a bucket listing produces no exceptions, all is well.
<pre>
S3Bucket[] myBuckets = s3Service.listAllBuckets();
</pre>

<h3>Create a bucket</h3>
<p>To store data in S3 you must first create a bucket, a container for objects.</p>
<pre>
S3Bucket testBucket = s3Service.createBucket(awsAccessKey + ".Test");
System.out.println("Created test bucket: " + testBucket.getName());
</pre>
<p>Notice how the code above used your AWS Access Key as a prefix to the bucket name? It is a good idea to follow this approach as bucket names must be unique in S3. If you try using a common name, you will probably not be able to create the bucket as someone else will already have a bucket of that name.</p>
<pre>
// This will probably fail, as someone else has already created a 'Test' bucket.
try {
	S3Bucket testBucket = s3Service.createBucket("Test");
} catch (S3ServiceException e) {
	System.err.println("Error code and message from S3: " 
		+ e.getErrorCode() + " - " + e.getErrorMessage());
}
</pre>

<h3>Uploading data objects</h3>
<p>We use <tt>S3Object</tt> classes to represent data objects in S3. To store some information in our new test bucket, we must first create an object with a key/name then tell our S3Service to upload it to S3. 
<p>In the example below, we print out information about the S3Object before and after uploading it to S3. These print-outs demonstrate that the S3Object returned by the putObject method contains extra information provided by S3, such as the date the object was last modified on an S3 server.</p>
<pre>
// Upload an object with a key/name.
S3Object object = new S3Object("object");
System.out.println("S3Object before upload: " + object);
object = s3Service.putObject(testBucket, object);
System.out.println("S3Object after upload: " + object);
System.out.println(object);
</pre>

<p>The example above will create an empty object in S3, which isn't very useful. To include data in the object you must provide an InputStream containing the information you want to upload, and you should also tell the object how much data you are uploading. If you know the <a href="http://en.wikipedia.org/wiki/Content-type">Content/Mime type</a> of the data you should set this too.</p>
<p>Note: It isn't strictly necessary to set the Content Length as jets3t can work out the value itself, however it's a good habit to do this as saves it can prevent problems when uploading large objects.</p>
<pre>
// Upload an object containing data.
S3Object helloWorldObject = new S3Object("helloWorld.txt");
String greeting = "Hello World!";
ByteArrayInputStream greetingIS = new ByteArrayInputStream(greeting.getBytes());
helloWorldObject.setDataInputStream(greetingIS);
helloWorldObject.setContentLength(greetingIS.available());
helloWorldObject.setContentType("text/plain");
helloWorldObject = s3Service.putObject(testBucket, helloWorldObject);
System.out.println("S3Object with data: " + helloWorldObject);
</pre>
<p>Note: As a convenience <tt>S3Object</tt> can be constructed with a File object, which will automatically use the File's name as the key and set the DataInputStream and ContentLength variables.</p>

<h3>Downloading data objects</h3>
<p>To download data from S3, you must retrieve an <tt>S3Object</tt> through the S3Service. You may retrieve an object in one of two ways, with the data contents or without.</p>
<p>If you just want to know some details about an object and you don't need its contents, its better to use the <tt>getObjectDetails</tt> method. This returns only the object's details or 'HEAD' information including its size, date, other and metadata associated with it such as the Content Type.</p>
<pre>
S3Object objectDetailsOnly = s3Service.getObjectDetails(testBucket, "helloWorld.txt");
System.out.println("S3Object, details only: " + objectDetailsOnly);
</pre>

<p>If you need the contents of the object, the <tt>getObject</tt> method will return all the object's details and will also include a DataInputStream variable from which the object's contents can be read.</p>
<pre>
S3Object objectComplete = s3Service.getObject(testBucket, "helloWorld.txt");
System.out.println("S3Object, complete: " + objectComplete);
BufferedReader reader = new BufferedReader(
	new InputStreamReader(objectComplete.getDataInputStream()));
String data = reader.readLine();
System.out.println("Greeting: " + data);
</pre>

<h3>List your buckets and objects</h3>
<p>Now that you have a bucket and some objects, it's worth listing them. Note that when you list objects, the objects returned will not include much information compared to what you get from the <tt>getObject</tt> and <tt>getObjectDetails</tt> methods. However, they will include the size of each object<p>
<pre>
// List all my buckets.
S3Bucket[] buckets = s3Service.listAllBuckets();
for (int b = 0; b < buckets.length; b++) {
	System.out.println("Bucket '" + buckets[b].getName() + "' contains:");
	
	// List the objects in each bucket, and see how much data my buckets contain.
	long byteCount = 0;
	S3Object[] objects = s3Service.listObjects(buckets[b]);
	for (int o = 0; o < objects.length; o++) {
		System.out.println(" " + objects[o].getKey() + " (" + objects[o].getContentLength() + " bytes)");
		byteCount += objects[o].getContentLength();
	}
	System.out.println(" TOTAL BYTES: " + byteCount);
}
</pre>


<h3>Deleting objects and buckets</h3>
<p>Objects can be easily deleted. When they are gone they are gone for good so be careful. Buckets may only be deleted when they are empty.</p>
<pre>
try {
	// This will fail if the bucket isn't empty.
	s3Service.deleteBucket(testBucket.getName());
} catch (S3ServiceException e) {
	e.printStackTrace();
}

// Delete the objects in the bucket
s3Service.deleteObject(testBucket, object.getKey());
s3Service.deleteObject(testBucket, helloWorldObject.getKey());

// Now that the bucket is empty, you can delete it.
s3Service.deleteBucket(testBucket.getName());
System.out.println("Deleted bucket " + testBucket.getName());
</pre>

<h2>Executor Examples</h2>
<h3>Upload multiple files at once</h3>

<h2>Advanced Examples</h2>
<h3>Manage Access Control Lists</h3>
<h3>Save and load encrypted AWS Credentials</h3>
<h3>Grant temporary access to an object</h3>


</body>
</html>