<?xml version="1.0"?>
<!-- ====================================================================== 
     jets3t    
     Toolkit for Amazon's S3 online storage service.
                   
     James Murty                                                                
     ====================================================================== -->
<project name="jets3t" default="dist">
    <description>
    		jets3t : Toolkit for Amazon's S3 online storage service
    </description>
	
	<property file="build.properties"/>
	
    <!-- ================================= 
         Define the script-wide classpath.
         ================================= -->
	<path id="classpath">
		<fileset dir="${dir.libs}" includes="**/*.jar"/>
	</path>
	
	
	<target name="compile-service">
		<mkdir dir="${dir.build}"/>
		<javac 
			srcdir="${dir.src}"
			destdir="${dir.build}"
			debug="${debug}"
		>
			<classpath refid="classpath"/>
			<include name="org/jets3t/service/**"/>
		</javac>
	</target>
	
	<target name="compile-app-cockpit">
		<mkdir dir="${dir.build}"/>
		<javac 
			srcdir="${dir.src}"
			destdir="${dir.build}"
			debug="${debug}"
		>
			<classpath refid="classpath"/>
			<include name="org/jets3t/apps/cockpit/**"/>
		</javac>
	</target>

	<target name="compile-app-synchronize">
		<mkdir dir="${dir.build}"/>
		<javac 
			srcdir="${dir.src}"
			destdir="${dir.build}"
			debug="${debug}"
		>
			<classpath refid="classpath"/>
			<include name="org/jets3t/apps/synchronize/**"/>
		</javac>
	</target>
	
	<target name="dist-service" depends="compile-service">
		<mkdir dir="${dir.dist}/jets3t-${version}"/>
		<jar
			basedir="${dir.build}"			
			file="${dir.dist}/jets3t-${version}/${dist.file.service}"
			>
			<include name="org/jets3t/service/**"/>
		</jar>
	</target>

	<target name="dist-app-cockpit" depends="dist-service,compile-app-cockpit">
		<mkdir dir="${dir.dist}/jets3t-${version}"/>
		<jar
			basedir="${dir.build}"			
			file="${dir.dist}/jets3t-${version}/${dist.file.cockpit}"
			manifest="${dir.src}/cockpit.mf"
			>
			<include name="org/jets3t/apps/cockpit/**"/>
		</jar>
	</target>
	
	<target name="dist-app-synchronize" depends="dist-service,compile-app-synchronize">
		<mkdir dir="${dir.dist}/jets3t-${version}"/>
		<jar
			basedir="${dir.build}"			
			file="${dir.dist}/jets3t-${version}/${dist.file.synchronize}"
			manifest="${dir.src}/synchronize.mf"
			>
			<include name="org/jets3t/apps/synchronize/**"/>
		</jar>
	</target>
	
	<target name="dist-apps" depends="dist-app-cockpit,dist-app-synchronize">
	</target>

	<target name="dist" depends="dist-service,dist-apps">
	</target>
	
	<target name="package" depends="dist,api-docs">
		<!-- Copy documentation to dist directory so it's included in archive files -->
		<mkdir dir="${dir.dist}/jets3t-${version}/docs/api"/>
		<copy 			
			todir="${dir.dist}/jets3t-${version}/docs">
			<fileset dir="www" includes="**/*.htm*"/>
		</copy>
		<copy 			
			todir="${dir.dist}/jets3t-${version}/docs/api">
			<fileset dir="${dir.apidocs}"/>
		</copy>
		
		<!-- Create archives -->
		<zip 
			destfile="${dir.dist}/jets3t-${version}.zip"
			basedir="${dir.dist}/jets3t-${version}"/>
		<tar 
			compression="gzip"
			destfile="${dir.dist}/jets3t-${version}.tar.gz"
			basedir="${dir.dist}/jets3t-${version}"/>
	</target>

	<target name="clean">
		<delete dir="${dir.build}"/>
		<delete dir="${dir.dist}"/>
		<delete dir="${dir.apidocs}"/>
	</target>

	<target name="api-docs">		
		<mkdir dir="${dir.apidocs}"/>
		<javadoc 
			author="false" 
			version="true"
			destdir="${dir.apidocs}" 
			windowtitle="jets3t API : Amazon S3 Toolkit">
			
			<classpath refid="classpath"/>
			<fileset 
				dir="src" 
				includes="**/*.java"
				excludes="org/jets3t/service/impl/soap/axis/_2006_03_01/**/*.java"/>
		</javadoc>
	</target>

</project>

