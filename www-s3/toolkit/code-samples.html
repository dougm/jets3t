<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="content-type"
        content="text/html; charset=utf-8" />
  <meta name="robots"
        content="all" />
  <meta name="generator"
        content="RapidWeaver" />
  <meta name="generatorversion"
        content="3.5.1 (Build 264)" />

  <title>JetS3t - Programmer Guide: Code Samples</title>
  <link rel="stylesheet"
        type="text/css"
        media="screen"
        href="../rw_common/themes/ideal/styles.css" />
  <link rel="stylesheet"
        type="text/css"
        media="print"
        href="../rw_common/themes/ideal/print.css" />
  <link rel="stylesheet"
        type="text/css"
        media="handheld"
        href="../rw_common/themes/ideal/handheld.css" />
  <link rel="stylesheet"
        type="text/css"
        media="screen"
        href=
        "../rw_common/themes/ideal/css/width/width_variable.css" />
  <link rel="stylesheet"
        type="text/css"
        media="screen"
        href=
        "../rw_common/themes/ideal/css/sidebar/sidebar_right.css" />
        
<style type="text/css"
       media="all">
/*<![CDATA[*/
pre {
        font-face: arial;
        font-size: 1.2em;       
}

tt {
        font-face: arial;
        font-size: 1.2em;       
}
/*]]>*/
</style>
<script type="text/javascript"
      src="../rw_common/themes/ideal/javascript.js">
</script>
  <meta http-equiv="Content-Type"
        content="text/html; charset=utf-8" />
</head>

<body>
  <div id="container">
    <!-- Start container -->

    <div id="pageHeader">
      <!-- Start page header -->

      <h1>JetS3t</h1>

      <h2>An open source Java toolkit for Amazon S3</h2>
    </div><!-- End page header -->

    <div id="sidebarContainer">
      <!-- Start Sidebar wrapper -->

      <div id="navcontainer">
        <!-- Start Navigation -->

        <ul>
          <li><a href="../index.html"
             rel="self">Home</a></li>

          <li>
            <a href="../toolkit/toolkit.html"
                rel="self"
                class="currentAncestor">Toolkit</a>

            <ul>
              <li>
                <a href="../toolkit/guide.html"
                    rel="self"
                    class="currentAncestor">Programmer Guide</a>

                <ul>
                  <li><a href="code-samples.html"
                     rel="self"
                     id="current">Code Samples</a></li>
                </ul>
              </li>

              <li><a href="../toolkit/configuration.html"
                 rel="self">Configuration</a></li>

              <li><a href="../api/index.html"
                 rel="self">API Documentation</a></li>
            </ul>
          </li>

          <li><a href="../applications/applications.html"
             rel="self">Applications</a></li>

          <li><a href="../downloads.html"
             rel="self">Downloads</a></li>

          <li><a href="../support.html"
             rel="self">Help &amp; Support</a></li>
        </ul>
      </div><!-- End navigation -->

      <div class="sideHeader"></div><!-- Sidebar header -->

      <div id="sidebar">
        <!-- Start sidebar content -->

        <br />

        <p>Your donation will allow me to continue improving
        JetS3t. Thanks very much, James.</p>

        <form action="https://www.paypal.com/cgi-bin/webscr"
              method="post">
          <input type="hidden"
                name="cmd"
                value="_s-xclick" /><input type="image"
                src=
                "https://www.paypal.com/en_AU/i/btn/x-click-but04.gif"
                border="0"
                name="submit"
                alt=
                "Make payments with PayPal - it's fast, free and secure!" /><img alt=""
                border="0"
                src="https://www.paypal.com/en_AU/i/scr/pixel.gif"
                width="1"
                height="1" /><input type="hidden"
                name="encrypted"
                value=
                "-----BEGIN PKCS7-----MIIH0QYJKoZIhvcNAQcEoIIHwjCCB74CAQExggEwMIIBLAIBADCBlDCBjjELMAkGA1UEBhMCVVMxCzAJBgNVBAgTAkNBMRYwFAYDVQQHEw1Nb3VudGFpbiBWaWV3MRQwEgYDVQQKEwtQYXlQYWwgSW5jLjETMBEGA1UECxQKbGl2ZV9jZXJ0czERMA8GA1UEAxQIbGl2ZV9hcGkxHDAaBgkqhkiG9w0BCQEWDXJlQHBheXBhbC5jb20CAQAwDQYJKoZIhvcNAQEBBQAEgYCGekbLIa/D+EUuZHJQpxxdG80/fCPFhUHo4RMgI39s7BtbcydoZkLwjVvu4xr2oY+2vEgswbXVOcObX9Es/bDtqYima2738FDWdWpI3Ir5bP+YLg6ZfxXB3Bdr6C4eGGW7CDMC5I6TEdGRg0bCkvwOKPJxs+Jrz8zCnclHbkV4qDELMAkGBSsOAwIaBQAwggFNBgkqhkiG9w0BBwEwFAYIKoZIhvcNAwcECEeMm71jt20WgIIBKF4LIh1sQBGIipiPzdlROAKYlAtzcWESM50VW+sP+w3gFsCJ6WP8tRq5h6JZBm00/VH4GCyMj/ZPV9Ht/8nj7CPSn5R+YWaKCOXE3vh7ingd9/6TVgCsB+j5r+qvWZhmgF2UoCN3LOfsMf1sZkuhoy74uJdzvzWjfCDfUgqwU/zCq8idd5jsXrS5HvaD+oY1WvK+KUN5mT2lGxfpIAT/ZVKOeNIvp168uVz355GGWmEnRMFhGqeRQMhf9vJ5SUibEmwhnBOJS6V7F1xFkp0IrL9evwAjW0My++nDO6OnoPeu1EzMp9+Nk7TkwwjNmlKrzY0JwXJ3RhUR2/i2xK7zJ51ofatFv/ezKWW0lNpreq9XYXhhz4SBwpNxQP2t8L7dRj6gshWU+WyToIIDhzCCA4MwggLsoAMCAQICAQAwDQYJKoZIhvcNAQEFBQAwgY4xCzAJBgNVBAYTAlVTMQswCQYDVQQIEwJDQTEWMBQGA1UEBxMNTW91bnRhaW4gVmlldzEUMBIGA1UEChMLUGF5UGFsIEluYy4xEzARBgNVBAsUCmxpdmVfY2VydHMxETAPBgNVBAMUCGxpdmVfYXBpMRwwGgYJKoZIhvcNAQkBFg1yZUBwYXlwYWwuY29tMB4XDTA0MDIxMzEwMTMxNVoXDTM1MDIxMzEwMTMxNVowgY4xCzAJBgNVBAYTAlVTMQswCQYDVQQIEwJDQTEWMBQGA1UEBxMNTW91bnRhaW4gVmlldzEUMBIGA1UEChMLUGF5UGFsIEluYy4xEzARBgNVBAsUCmxpdmVfY2VydHMxETAPBgNVBAMUCGxpdmVfYXBpMRwwGgYJKoZIhvcNAQkBFg1yZUBwYXlwYWwuY29tMIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDBR07d/ETMS1ycjtkpkvjXZe9k+6CieLuLsPumsJ7QC1odNz3sJiCbs2wC0nLE0uLGaEtXynIgRqIddYCHx88pb5HTXv4SZeuv0Rqq4+axW9PLAAATU8w04qqjaSXgbGLP3NmohqM6bV9kZZwZLR/klDaQGo1u9uDb9lr4Yn+rBQIDAQABo4HuMIHrMB0GA1UdDgQWBBSWn3y7xm8XvVk/UtcKG+wQ1mSUazCBuwYDVR0jBIGzMIGwgBSWn3y7xm8XvVk/UtcKG+wQ1mSUa6GBlKSBkTCBjjELMAkGA1UEBhMCVVMxCzAJBgNVBAgTAkNBMRYwFAYDVQQHEw1Nb3VudGFpbiBWaWV3MRQwEgYDVQQKEwtQYXlQYWwgSW5jLjETMBEGA1UECxQKbGl2ZV9jZXJ0czERMA8GA1UEAxQIbGl2ZV9hcGkxHDAaBgkqhkiG9w0BCQEWDXJlQHBheXBhbC5jb22CAQAwDAYDVR0TBAUwAwEB/zANBgkqhkiG9w0BAQUFAAOBgQCBXzpWmoBa5e9fo6ujionW1hUhPkOBakTr3YCDjbYfvJEiv/2P+IobhOGJr85+XHhN0v4gUkEDI8r2/rNk1m0GA8HKddvTjyGw/XqXa+LSTlDYkqI8OwR8GEYj4efEtcRpRYBxV8KxAW93YDWzFGvruKnnLbDAF6VR5w/cCMn5hzGCAZowggGWAgEBMIGUMIGOMQswCQYDVQQGEwJVUzELMAkGA1UECBMCQ0ExFjAUBgNVBAcTDU1vdW50YWluIFZpZXcxFDASBgNVBAoTC1BheVBhbCBJbmMuMRMwEQYDVQQLFApsaXZlX2NlcnRzMREwDwYDVQQDFAhsaXZlX2FwaTEcMBoGCSqGSIb3DQEJARYNcmVAcGF5cGFsLmNvbQIBADAJBgUrDgMCGgUAoF0wGAYJKoZIhvcNAQkDMQsGCSqGSIb3DQEHATAcBgkqhkiG9w0BCQUxDxcNMDgwMTI4MDU0MzE1WjAjBgkqhkiG9w0BCQQxFgQUMpNMYhPnNhUSM51d9rAKmp0MOs8wDQYJKoZIhvcNAQEBBQAEgYCF4/pp+iF4fv5/XNSNRkqqDLfHoVF16arzCummkdjudm/wMS9quZmE9/yOGbocgSuL8gG/F6flh32e2I0iQpVPIyAJgAzEPmCHNAg9T0lMqpl59LblNip85M0sxHCD8jXtdIhzHlVthKxhLfbkPgbJYgbSoV12kXUeg9LtNS7bEg==-----END PKCS7----- " />
        </form>
        <br />
        <!-- sidebar content you enter in the page inspector -->
         <!-- sidebar content such as the blog archive links -->
      </div><!-- End sidebar content -->
    </div><!-- End sidebar wrapper -->

    <div id="contentContainer">
      <!-- Start main content wrapper -->

      <div id="content">
        <!-- Start content -->

        <div id="breadcrumbcontainer">
          <!-- Start the breadcrumb wrapper -->

          <ul>
            <li><a href=
            "../index.html">Home</a>&nbsp;&gt;&nbsp;</li>

            <li><a href=
            "../toolkit/toolkit.html">Toolkit</a>&nbsp;&gt;&nbsp;</li>

            <li><a href="../toolkit/guide.html">Programmer
            Guide</a>&nbsp;&gt;&nbsp;</li>

            <li><a href="code-samples.html">Code
            Samples</a>&nbsp;&gt;&nbsp;</li>
          </ul>
        </div><!-- End breadcrumb -->

        <h1>Programmer Guide: Code Samples</h1>

        <p>The JetS3t suite includes some code samples in the
        codebase package <tt>org.jets3t.samples</tt>. This document
        gives a detailed overview of the example code in
        <tt><b>CodeSamples.java</b></tt> which covers some basic
        JetS3t functionality. Pease refer to the samples package
        directory for examples of using the advanced JetS3t
        functionality.</p>

        <h3>Quick Links</h3>

        <table cellspacing="5"
               cellpadding="3">
          <tr>
            <th valign="top"
                rowspan="2">Basic</th>

            <td><a href="#connecting">Connecting to S3</a></td>

            <td><a href="#create-bucket">Create a Bucket</a></td>

            <td><a href="#uploading">Uploading Data or
            Files</a></td>
          </tr>

          <tr>
            <td><a href="#downloading">Downloading Objects</a></td>

            <td><a href="#listing">Listing Your Buckets and
            Objects</a></td>

            <td><a href="#deleting">Deleting Buckets and
            Objects</a></td>
          </tr>

          <tr>
            <th valign="top">Multi-threading</th>

            <td><a href="#uploading-multi">Multiple
            Uploads</a></td>

            <td><a href="#downloading-multi">Multiple
            Downloads</a></td>

            <td><a href="#deleting-multi">Multiple Deletes</a></td>
          </tr>

          <tr>
            <th valign="top"
                rowspan="2">Advanced</th>

            <td><a href="#metadata">Managing Metadata</a></td>

            <td><a href="#credentials">Securing Your AWS
            Credentials</a></td>

            <td><a href="#acls">Access Control</a></td>
          </tr>

          <tr>
            <td><a href="#signed-urls">Temporary Public
            URLs</a></td>

            <td><a href="#post">S3 POST Forms</a></td>
          </tr>
        </table>

        <h2>Basic Examples : CodeSamples.java</h2>

        <h3>Loading AWS Credentials</h3>

        <p>The JetS3t code samples need to know your AWS
        Credentials to work. All the sample classes use a utility
        method <tt><b>SamplesUtils.loadAWSCredentials()</b></tt> to
        load your AWS Credentials from a properties file called
        <b>samples.properties</b> in the classpath. Before running
        the sample code classes you must create this file and add
        the properties <b>awsAccessKey</b> and <b>awsSecretKey</b>
        set to your own AWS Credentials.</p>

        <h3>S3 Object representations</h3>

        <p>Items stored in S3 are represented by one of two
        objects:</p>

        <ul>
          <li><b>S3Bucket</b>: An S3Bucket is a top-level container
          in S3 in which objects are stored. Every bucket is
          identified by a name, and this name must be unique in
          S3.</li>

          <li><b>S3Object</b>: An S3Object is a data object stored
          inside a bucket. It is identified by a key, which can be
          any string name. An object also has a Content Length,
          which is the amount of the data in the object.</li>
        </ul>

        <h3><a name="connecting">Connnecting to S3</a></h3>

        <p>Your Amazon Web Services (AWS) login credentials are
        required to manage S3 accounts. These credentials are
        stored in an <tt>AWSCredentials</tt> object:</p>
        <pre>
String awsAccessKey = "YOUR_AWS_ACCESS_KEY";
String awsSecretKey = "YOUR_AWS_SECRET_KEY";
AWSCredentials awsCredentials = 
        new AWSCredentials(awsAccessKey, awsSecretKey);
</pre>

        <p>To communicate with S3, create a class that implements
        an <tt>S3Service</tt>. We will use the REST/HTTP
        implementation based on HttpClient, as this is the most
        robust implementation provided with jets3t.</p>
        <pre>
S3Service s3Service = new RestS3Service(awsCredentials);
</pre>

        <p>A good test to see if your S3Service can connect to S3
        is to list all the buckets you own. If a bucket listing
        produces no exceptions, all is well.</p>
        <pre>
S3Bucket[] myBuckets = s3Service.listAllBuckets();
System.out.println("How many buckets to I have in S3? " + myBuckets.length);
</pre>

        <h3><a name="create-bucket">Create a bucket</a></h3>

        <p>To store data in S3 you must first create a bucket, a
        container for objects.</p>
        <pre>
S3Bucket testBucket = s3Service.createBucket("test-bucket");
System.out.println("Created test bucket: " + testBucket.getName());
</pre>

        <p>If you try using a common name when you create a bucket,
        you will probably not be able to create the bucket as
        someone else will already have a bucket of that name.</p>

        <p>To create a bucket in an S3 data center located
        somewhere other than the United States, you can specify a
        location for your bucket as a second parameter to the
        createBucket() method. Currently, the only alternative S3
        location is Europe (EU).</p>
        <pre>
S3Bucket euBucket = s3Service.createBucket("eu-bucket", S3Bucket.LOCATION_EUROPE);
</pre>

        <h3><a name="uploading">Uploading data objects</a></h3>

        <p>We use <tt>S3Object</tt> classes to represent data
        objects in S3. To store some information in our new test
        bucket, we must first create an object with a key/name then
        tell our S3Service to upload it to S3.</p>

        <p>In the example below, we print out information about the
        S3Object before and after uploading it to S3. These
        print-outs demonstrate that the S3Object returned by the
        putObject method contains extra information provided by S3,
        such as the date the object was last modified on an S3
        server.</p>
        <pre>
// Create an empty object with a key/name, and print the object's details.
S3Object object = new S3Object("object");
System.out.println("S3Object before upload: " + object);

// Upload the object to our test bucket in S3.
object = s3Service.putObject(testBucket, object);

// Print the details about the uploaded object, which contains more information.
System.out.println("S3Object after upload: " + object);
</pre>

        <p>The example above will create an empty object in S3,
        which isn't very useful. To include data in the object you
        must provide some data for the object. If you know the
        Content/Mime type of the data (e.g. text/plain) you should
        set this too.</p>

        <p>S3Object's can contain any data available from an input
        stream, but JetS3t provides two convenient object types to
        hold File or String data. These convenient constructors
        automatically set the Content-Type and Content-Length of
        the object.</p>
        <pre>
// Create an S3Object based on a string, with Content-Length set automatically and 
// Content-Type set to "text/plain"  
String stringData = "Hello World!";
S3Object stringObject = new S3Object(testBucket, "HelloWorld.txt", stringData);

// Create an S3Object based on a file, with Content-Length set automatically and 
// Content-Type set based on the file's extension (using the Mimetypes utility class)
File fileData = new File("src/org/jets3t/samples/CodeSamples.java");
S3Object fileObject = new S3Object(testBucket, fileData);
</pre>

        <p>If your data isn't a File or String you can use any
        input stream as a data source, but you must manually set
        the Content-Length. <b>Note</b>: It isn't strictly
        necessary to set the Content Length as the jets3t toolkit
        can work out the value itself, however it's a good habit to
        do this as it can prevent problems when uploading large
        objects.</p>
        <pre>
// Create an object containing a greeting string as input stream data.
String greeting = "Hello World!";
S3Object helloWorldObject = new S3Object("HelloWorld2.txt");
ByteArrayInputStream greetingIS = new ByteArrayInputStream(greeting.getBytes());
helloWorldObject.setDataInputStream(greetingIS);
helloWorldObject.setContentLength(greetingIS.available());
helloWorldObject.setContentType("text/plain");

// Upload the data objects.
s3Service.putObject(testBucket, stringObject);
s3Service.putObject(testBucket, fileObject);
s3Service.putObject(testBucket, helloWorldObject);

// Print details about the uploaded object.
System.out.println("S3Object with data: " + helloWorldObject);
</pre>

        <h3><a name="downloading">Downloading data objects</a></h3>

        <p>To download data from S3 you retrieve an
        <tt>S3Object</tt> through the S3Service. You may retrieve
        an object in one of two ways, with the data contents or
        without.</p>

        <p>If you just want to know some details about an object
        and you don't need its contents, it's faster to use the
        <tt>getObjectDetails</tt> method. This returns only the
        object's details, also known as its 'HEAD'. Head
        information includes the object's size, date, and other
        metadata associated with it such as the Content Type.</p>
        <pre>
// Retrieve the HEAD of the data object we created previously.
S3Object objectDetailsOnly = s3Service.getObjectDetails(testBucket, "helloWorld.txt");
System.out.println("S3Object, details only: " + objectDetailsOnly);
</pre>

        <p>If you need the data contents of the object, the
        <tt>getObject</tt> method will return all the object's
        details and will also set the object's DataInputStream
        variable from which the object's data can be read.</p>
        <pre>
// Retrieve the whole data object we created previously
S3Object objectComplete = s3Service.getObject(testBucket, "helloWorld.txt");
System.out.println("S3Object, complete: " + objectComplete);

// Read the data from the object's DataInputStream using a loop, and print it out.
System.out.println("Greeting:");
BufferedReader reader = new BufferedReader(
        new InputStreamReader(objectComplete.getDataInputStream()));
String data = null;
while ((data = reader.readLine()) != null) {
        System.out.println(data);
}
</pre>

        <h3><a name="listing">List your buckets and
        objects</a></h3>

        <p>Now that you have a bucket and some objects, it's worth
        listing them. Note that when you list objects, the objects
        returned will not include much information compared to what
        you get from the <tt>getObject</tt> and
        <tt>getObjectDetails</tt> methods. However, they will
        include the size of each object</p>
        <pre>
// List all your buckets.
S3Bucket[] buckets = s3Service.listAllBuckets();

// List the object contents of each bucket.
for (int b = 0; b &lt; buckets.length; b++) {
        System.out.println("Bucket '" + buckets[b].getName() + "' contains:");
        
        // List the objects in this bucket.
        S3Object[] objects = s3Service.listObjects(buckets[b]);

        // Print out each object's key and size.
        for (int o = 0; o &lt; objects.length; o++) {
                System.out.println(" " + objects[o].getKey() + " (" + objects[o].getContentLength() + " bytes)");
        }
}
</pre>

        <p>When listing the objects in a bucket you can filter
        which objects to return based on the names of those
        objects. This is useful when you are only interested in
        some specific objects in a bucket and you don't need to
        list all the bucket's contents.</p>
        <pre>
// List only objects whose keys match a prefix. 
String prefix = "Reports";
String delimiter = null; // Refer to the S3 guide for more information on delimiters
S3Object[] filteredObjects = s3Service.listObjects(testBucket, prefix, delimiter);
</pre>

        <h3><a name="deleting">Deleting objects and
        buckets</a></h3>

        <p>Objects can be easily deleted. When they are gone they
        are gone for good so be careful.</p>

        <p>Buckets may only be deleted when they are empty.</p>
        <pre>
// If you try to delete your bucket before it is empty, it will fail.
try {
        // This will fail if the bucket isn't empty.
        s3Service.deleteBucket(testBucket.getName());
} catch (S3ServiceException e) {
        e.printStackTrace();
}

// Delete all the objects in the bucket
s3Service.deleteObject(testBucket, object.getKey());
s3Service.deleteObject(testBucket, helloWorldObject.getKey());

// Now that the bucket is empty, you can delete it.
s3Service.deleteBucket(testBucket.getName());
System.out.println("Deleted bucket " + testBucket.getName());
</pre>

        <h2>Multi-threaded Examples</h2>

        <p>The jets3t Toolkit includes utility services,
        <tt>S3ServiceMulti</tt> and <tt>S3ServiceSimpleMulti</tt>,
        that can perform an S3 operation on many objects at a time.
        These services allow you to use more of your available
        bandwidth and perform S3 operations much faster. They work
        with any thread-safe S3Service implementation, such as the
        HTTP/REST and SOAP implementations provided with
        jets3t.</p>

        <p>The <tt>S3ServiceMulti</tt> service is intended for
        advanced developers. It is designed for use in graphical
        applications and uses an event-notification approach to
        communicate its results rather than standard method calls.
        This means the service can provide progress reports to an
        application during long-running operations. However, this
        approach makes the service complicated to use. See the code
        for the Cockpit application to see how this service is used
        to display progress updates.</p>

        <p>The <tt>S3ServiceSimpleMulti</tt> is a service that
        wraps around S3ServiceMulti and provides a simplified
        interface, so developers can take advantage of
        multi-threading without any extra work.</p>

        <p>The examples below demonstrate how to use some of the
        multi-threaded operations provided by
        S3ServiceSimpleMulti.</p>

        <h3>Construct an S3ServiceSimpleMulti service</h3>

        <p>To use the S3ServiceSimpleMulti service you construct it
        by providing an existing S3Service object.</p>
        <pre>
// Create a simple multi-threading service based on our existing S3Service
S3ServiceSimpleMulti simpleMulti = new S3ServiceSimpleMulti(s3Service);
</pre>

        <h3><a name="uploading-multi">Upload multiple objects at
        once</a></h3>

        <p>To demonstrate multiple uploads, let's create some small
        text-data objects and a bucket to put them in.</p>
        <pre>
// First, create a bucket.
S3Bucket bucket = new S3Bucket(awsAccessKey + ".TestMulti");
bucket = s3Service.createBucket(bucket);

// Create an array of data objects to upload.
S3Object[] objects = new S3Object[5];
objects[0] = new S3Object(bucket, "object1.txt", "Hello from object 1");
objects[1] = new S3Object(bucket, "object2.txt", "Hello from object 2");
objects[2] = new S3Object(bucket, "object3.txt", "Hello from object 3");
objects[3] = new S3Object(bucket, "object4.txt", "Hello from object 4");
objects[4] = new S3Object(bucket, "object5.txt", "Hello from object 5");
</pre>

        <p>Now we have some sample objects, we can upload them.</p>
        <pre>
// Upload multiple objects.
S3Object[] createdObjects = simpleMulti.putObjects(bucket, objects);        
System.out.println("Uploaded " + createdObjects.length + " objects");
</pre>

        <h3>Retrieve the HEAD information of multiple objects</h3>
        <pre>
// Perform a Details/HEAD query for multiple objects.
S3Object[] objectsWithHeadDetails = simpleMulti.getObjectsHeads(bucket, objects);

// Print out details about all the objects.
System.out.println("Objects with HEAD Details...");
for (int i = 0; i &lt; objectsWithHeadDetails.length; i++) {
        System.out.println(objectsWithHeadDetails[i]);
}
</pre>

        <h3><a name="downloading-multi">Download objects to local
        files</a></h3>

        <p>The multi-threading services provide a method to
        download multiple objects at a time, but to use this you
        must first prepare somewhere to put the data associated
        with each object. The most obvious place to put this data
        is into a file, so let's go through an example of
        downloading object data into files.</p>

        <p>To download our objects into files we first must create
        a <tt>S3ObjectAndOutputStream</tt> class for each object.
        This class is a simple container which merely associates an
        object with an output stream, to which the object's data
        will be written.</p>
        <pre>
// Create a DownloadPackage for each object, to associate the object with an output file.
DownloadPackage[] downloadPackages = new DownloadPackage[5];
downloadPackages[0] = new DownloadPackage(objects[0], 
    new File(objects[0].getKey()));
downloadPackages[1] = new DownloadPackage(objects[1], 
    new File(objects[1].getKey()));
downloadPackages[2] = new DownloadPackage(objects[2], 
    new File(objects[2].getKey()));
downloadPackages[3] = new DownloadPackage(objects[3], 
    new File(objects[3].getKey()));
downloadPackages[4] = new DownloadPackage(objects[4], 
    new File(objects[4].getKey()));

// Download the objects.
simpleMulti.downloadObjects(bucket, downloadPackages);
System.out.println("Downloaded objects to current working directory");
</pre>

        <h3><a name="deleting-multi">Delete multiple
        objects</a></h3>

        <p>It's time to clean up, so let's get rid of our multiple
        objects and test bucket.</p>
        <pre>
// Delete multiple objects, then the bucket too.
simpleMulti.deleteObjects(bucket, objects);
s3Service.deleteBucket(bucket);
System.out.println("Deleted bucket: " + bucket);
</pre>

        <h2>Advanced Examples</h2>

        <h3><a name="metadata">Managing Metadata</a></h3>

        <p><tt>S3Object</tt>s can contain metadata stored as
        name/value pairs. This metadata is stored in S3 and can be
        accessed when an object is retrieved from S3 using
        <tt>getObject</tt> or <tt>getObjectDetails</tt> methods. To
        store metadata with an object, add your metadata to the
        object prior to uploading it to S3.</p>

        <p>Note that metadata cannot be updated in S3 without
        replacing the existing object, and that metadata names must
        be strings without spaces.</p>
        <pre>
S3Object objectWithMetadata = new S3Object("metadataObject");
objectWithMetadata.addMetadata("favourite-colour", "blue");
objectWithMetadata.addMetadata("document-version", "0.3");
</pre>

        <h3><a name="credentials">Save and load encrypted AWS
        Credentials</a></h3>

        <p>AWS credentials are your means to login to and manage
        your S3 account, and should be kept secure. The jets3t
        toolkit stores these credentials in <tt>AWSCredentials</tt>
        objects. The AWSCredentials class provides utility methods
        to allow credentials to be saved to an encrypted file and
        loaded from a previously saved file with the right
        password.</p>
        <pre>
// Save credentials to an encrypted file protected with a password.
File credFile = new File("awscredentials.enc");
awsCredentials.save("password", credFile);

// Load encrypted credentials from a file.
AWSCredentials loadedCredentials = AWSCredentials.load("password", credFile);
System.out.println("AWS Key loaded from file: " + loadedCredentials.getAccessKey());

// You won't get far if you use the wrong password...
try {
        loadedCredentials = AWSCredentials.load("wrongPassword", credFile);
} catch (S3ServiceException e) {
        System.err.println("Cannot load credentials from file with the wrong password!");
}
</pre>

        <h3><a name="acls">Manage Access Control Lists</a></h3>

        <p>S3 uses Access Control Lists to control who has access
        to buckets and objects in S3. By default, any bucket or
        object you create will belong to you and will not be
        accessible to anyone else. You can use jets3t's support for
        access control lists to make buckets or objects publicly
        accessible, or to allow other S3 members to access or
        manage your objects.</p>

        <p>The ACL capabilities of S3 are quite involved, so to
        understand this subject fully please consult Amazon's
        documentation. The code examples below show how to put your
        understanding of the S3 ACL mechanism into practice.</p>

        <p>ACL settings may be provided with a bucket or object
        when it is created, or the ACL of existing items may be
        updated. Let's start by creating a bucket with default (ie
        private) access settings, then making it public.</p>
        <pre>
// Create a bucket in S3.
S3Bucket publicBucket = new S3Bucket(awsAccessKey + ".publicBucket");
s3Service.createBucket(publicBucket);

// Retrieve the bucket's ACL and modify it to grant public access, 
// ie READ access to the ALL_USERS group.
AccessControlList bucketAcl = s3Service.getBucketAcl(publicBucket);
bucketAcl.grantPermission(GroupGrantee.ALL_USERS, Permission.PERMISSION_READ);

// Update the bucket's ACL. Now anyone can view the list of objects in this bucket.
publicBucket.setAcl(bucketAcl);
s3Service.putBucketAcl(publicBucket);
System.out.println("View bucket's object listing here: http://s3.amazonaws.com/" 
        + publicBucket.getName());
</pre>

        <p>Now let's create an object that is public from scratch.
        Note that we will use the bucket's public ACL object
        created above, this works fine. Although it is possible to
        create an <tt>AccessControlList</tt> object from scratch,
        this is more involved as you need to set the ACL's Owner
        information which is only readily available from an
        existing ACL.</p>
        <pre>
// Create a public object in S3. Anyone can download this object. 
S3Object publicObject = new S3Object(
        publicBucket, "publicObject.txt", "This object is public");
publicObject.setAcl(bucketAcl);
s3Service.putObject(publicBucket, publicObject);        
System.out.println("View public object contents here: http://s3.amazonaws.com/" 
        + publicBucket.getName() + "/" + publicObject.getKey());
</pre>

        <p>The ALL_USERS Group is particularly useful, but there
        are also other grantee types that can be used with
        AccessControlList. Please see Amazon's S3 technical
        documentation for a fuller discussion of these
        settings.</p>
        <pre>
AccessControlList acl = new AccessControlList();
        
// Grant access by email address. Note that this only works email address of AWS S3 members.
acl.grantPermission(new EmailAddressGrantee("someone@somewhere.com"), 
        Permission.PERMISSION_FULL_CONTROL);

// Grant control of ACL settings to a known AWS S3 member.
acl.grantPermission(new CanonicalGrantee("AWS member's ID"), 
        Permission.PERMISSION_READ_ACP);
acl.grantPermission(new CanonicalGrantee("AWS member's ID"), 
        Permission.PERMISSION_WRITE_ACP);
</pre>

        <h3><a name="signed-urls">Temporarily make an Object
        available to anyone</a></h3>

        <p>A private object stored in S3 can be made publicy
        available for a limited time using a signed URL. The signed
        URL can be used by anyone to download the object, yet it
        includes a date and time after which the URL will no longer
        work.</p>
        <pre>
// Create a private object in S3.
S3Bucket privateBucket = new S3Bucket("privateBucket");
S3Object privateObject = new S3Object(
        privateBucket, "privateObject.txt", "This object is private");
s3Service.createBucket(privateBucket);
s3Service.putObject(privateBucket, privateObject);        

// Determine what the time will be in 5 minutes.
Calendar cal = Calendar.getInstance();
cal.add(Calendar.MINUTE, 5);
Date <b>expiryDate</b> = cal.getTime();
</pre>

        <p>If you use the generated URL in a web browser within 5
        minutes, you will be able to view the object's contents.
        After 5 minutes, the URL will no longer work and you will
        only see an Access Denied message.</p>
        <pre>
// Create a signed HTTP URL valid for 5 minutes.
boolean isHttpsUrl = false; // Choose whether URL is HTTP or HTTPS.
String url = S3Service.createSignedGetUrl(privateBucket.getName(), privateObject.getKey(), 
            awsCredentials, expiryDate);
System.out.println("Signed URL: " + url);
</pre>

        <h3><a name="post">Create an S3 POST form</a></h3>

        <p>When you create and S3 POST form, anyone who accesses
        that form in a web browser will be able to upload files to
        S3 directly from the browser, without needing S3-compatible
        client software. Refer to the S3 <a href=
        "http://docs.amazonwebservices.com/AmazonS3/2006-03-01/UsingHTTPPOST.html">
        POST</a> documentation for more information.</p>

        <p>We will start by creating a POST form with no policy
        document, meaning that the form will have no expiration
        date or usage conditions. This form will only work if the
        target bucket has public write access enabled.</p>
        <pre>
        
String unrestrictedForm = S3Service.buildPostForm("public-bucket", "${filename}");
</pre>

        <p>To use this form, save it in a UTF-8 encoded HTML page
        (ie with the meta tag ) and load the page in a web
        browser.</p>

        <p>We will now create a POST form with a range of policy
        conditions, that will allow users to upload image files to
        a protected bucket.</p>
        <pre>
String bucketName = "test-bucket";
String key = "uploads/images/pic.jpg";
</pre>

        <p>Specify input fields to set the access permissions and
        content type of the object created by the form. We will
        also redirect the user to another web site after they have
        successfully uploaded a file.</p>
        <pre>
        String[] inputFields = new String[] {
            "&lt;input type=\"hidden\" name=\"acl\" value=\"public-read\"&gt;",
            "&lt;input type=\"hidden\" name=\"Content-Type\" value=\"image/jpeg\"&gt;",
            "&lt;input type=\"hidden\" name=\"success_action_redirect\" value=\"http://localhost/post_upload\"&gt;"
        };
</pre>

        <p>We then specify policy conditions for at least the
        mandatory 'bucket' and 'key' fields that will be included
        in the POST request. In addition to the mandatory fields,
        we will add a condition to control the size of the file the
        user can upload.</p>

        <p>Note that our list of conditions must include a
        condition corresponding to each of the additional input
        fields we specified above.</p>
        <pre>
String[] conditions = {
    S3Service.generatePostPolicyCondition_Equality("bucket", bucketName),
    S3Service.generatePostPolicyCondition_Equality("key", key),
    S3Service.generatePostPolicyCondition_Range(10240, 204800),
    // Conditions to allow the additional fields specified above
    S3Service.generatePostPolicyCondition_Equality("acl", "public-read"),
    S3Service.generatePostPolicyCondition_Equality("Content-Type", "image/jpeg"),
    S3Service.generatePostPolicyCondition_Equality("success_action_redirect", "http://localhost/post_upload")
};

// Form will expire in 24 hours
cal = Calendar.getInstance();
cal.add(Calendar.HOUR, 24);
Date expiration = cal.getTime();
        
// Generate the form.
String restrictedForm = S3Service.buildPostForm(
    bucketName, key, awsCredentials, expiration, conditions, 
    inputFields, null, true);       
</pre>

        <div class="clearer"></div>

        <div id="footer">
          <!-- Start Footer -->

          <p>© 2008 James Murty</p>
        </div>

        <table>
          <tr>
            <td><a href=""></a></td>
          </tr><!-- End content -->
          <!-- End main content wrapper -->
          <!-- End Footer -->
          <!-- End container -->
        </table>
      </div>
    </div>
  </div>
</body>
</html>
